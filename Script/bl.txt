import os
import time
import win32com.client as win32
import pyautogui

# Change this to your folder with Word files
input_folder = r"C:\path\to\word\files"

# Delay times for UI automation (adjust if your PC is slow)
WORD_LOAD_DELAY = 2
DBT_LOAD_DELAY = 3

def convert_docx_to_dxp(docx_path):
    # Open Word
    word = win32.Dispatch("Word.Application")
    word.Visible = True

    # Open document
    doc = word.Documents.Open(docx_path)
    time.sleep(WORD_LOAD_DELAY)

    # Select BANA UEB format from Braille tab
    # (We simulate ALT navigation — adjust keys as needed for your Word)
    pyautogui.hotkey('alt', 'y')  # Example: Alt+Y for Braille tab
    time.sleep(0.5)
    pyautogui.press('')  # Example: 'B' for BANA UEB (depends on Word's hotkeys)
    time.sleep(1)

    # Save document in Word
    doc.Save()

    # Click "Open in DBT" button (assuming hotkey or UI location)
    pyautogui.hotkey('alt', 'y1')
    time.sleep(0.5)
    pyautogui.press('o')  # Example: 'O' for Open in DBT
    time.sleep(DBT_LOAD_DELAY)

    # Save as DXP in DBT
    base_name = os.path.splitext(os.path.basename(docx_path))[0]
    dxp_path = os.path.join(os.path.dirname(docx_path), base_name + ".dxp")

    pyautogui.hotkey('ctrl', 's')
    time.sleep(0.5)
    pyautogui.typewrite(dxp_path)
    pyautogui.press('enter')

    # Close both programs
    doc.Close(False)
    word.Quit()
    pyautogui.hotkey('alt', 'f4')  # Close DBT

# Loop through all docx files
for file in os.listdir(input_folder):
    if file.lower().endswith(".docx"):
        convert_docx_to_dxp(os.path.join(input_folder, file))

print("✅ Conversion completed for all files.")
